/*
 * TabbedTemplatePanel.java
 *
 * Created on February 2, 2007, 1:50 PM
 */

package com.webreach.mirth.client.ui.editors;

import java.util.HashMap;
import java.util.List;
import java.util.Properties;

import javax.swing.DefaultComboBoxModel;
import javax.swing.JPanel;

import org.syntax.jedit.SyntaxDocument;

import com.webreach.mirth.client.ui.PlatformUI;
import com.webreach.mirth.client.ui.TreePanel;
import com.webreach.mirth.client.ui.UIConstants;
import com.webreach.mirth.client.ui.VariableListHandler;
import com.webreach.mirth.client.ui.panels.reference.VariableReferenceTable;
import com.webreach.mirth.model.Step;

/**
 *
 * @author  brendanh
 */
public class TabbedTemplatePanel extends javax.swing.JPanel
{
    private VariableReferenceTable globalVarTable, dbVarTable;
    private SyntaxDocument incomingHL7Doc, outgoingHL7Doc;
    private TreePanel incomingTreePanel, outgoingTreePanel;
    private MirthEditorPane parent;
    private HashMap<String, JPanel> panels;
    
    /** Creates new form TabbedTemplatePanel */
    public TabbedTemplatePanel(MirthEditorPane p)
    {
        parent = p;
        initComponents();
        resizePanes();
        
        panels = new HashMap<String, JPanel>();
        
        //ArrayList<ReferenceListItem> functionListItems = new ReferenceListBuilder().getVariableListItems();
        variableTable = new VariableReferenceTable("Available Variables", new String[]{}); 
        variableTable.setDragEnabled(true);
        variableTable.setTransferHandler(new VariableListHandler("$('", "')"));
        variableListScrollPane.setViewportView(variableTable);
    }
      
    public void resizePanes()
    {
        variableSplitPane.setDividerLocation((int)(PlatformUI.MIRTH_FRAME.currentContentPage.getHeight()/2 - PlatformUI.MIRTH_FRAME.currentContentPage.getHeight()/10));
        incoming.resizePanes();
        outgoing.resizePanes();
    }
    
    public void updateVariables(List<Step> steps)
    {
        variableTable.updateVariables(steps);
    }
    
    public String getIncomingMessage()
    {
        return incoming.getMessage();
    }
    
    public void setIncomingMessage(String msg)
    {
        incoming.setMessage(msg);
    }
    
    public String getOutgoingMessage()
    {
        return outgoing.getMessage();
    }
    
    public void setOutgoingMessage(String msg)
    {
        outgoing.setMessage(msg);
    }
    
    public void setIncomingDataType(String protocol)
    {
        incoming.setProtocol(protocol);
    }
    
    public void setOutgoingDataType(String protocol)
    {
        outgoing.setProtocol(protocol);
    }

    public String getIncomingDataType()
    {
        return incoming.getProtocol();
    }
    
    public String getOutgoingDataType()
    {
        return outgoing.getProtocol();
    }
    
    public void setIncomingDataProperties(Properties properties)
    {
        incoming.setDataProperties(properties);
    }
    
    public void setOutgoingDataProperties(Properties properties)
    {
        outgoing.setDataProperties(properties);
    }
    
    public Properties getIncomingDataProperties()
    {
        return incoming.getDataProperties();
    }
    
    public Properties getOutgoingDataProperties()
    {
        return outgoing.getDataProperties();
    }
    
    public void setDefaultComponent()
    {
        tabPanel.setSelectedIndex(0);
    }
    
    public void addPanel(JPanel panel, String name)
    {
        panels.put(name, panel);
        
        String[] items = new String[panels.keySet().size()];
        int i = 0;
        for(String s : panels.keySet())
        {
            items[i] = s;
            i++;
        }
        
        variableReferenceDropDown.setModel(new DefaultComboBoxModel(items));
    }
    
    public void setReferencePanel()
    {
        variableReferenceDropDownActionPerformed(null);
    }
    
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc=" Generated Code ">//GEN-BEGIN:initComponents
    private void initComponents()
    {
        tabPanel = new javax.swing.JTabbedPane();
        variableTab = new javax.swing.JPanel();
        variableSplitPane = new javax.swing.JSplitPane();
        variableListScrollPane = new javax.swing.JScrollPane();
        variableTable = new com.webreach.mirth.client.ui.panels.reference.VariableReferenceTable();
        variableReferencePane = new javax.swing.JPanel();
        variableReferenceDropDown = new com.webreach.mirth.client.ui.components.MirthComboBox();
        variableScrollPane = new javax.swing.JScrollPane();
        incomingTab = new javax.swing.JPanel();
        incoming = new MessageTreeTemplate(UIConstants.INCOMING_DATA);
        outgoingTab = new javax.swing.JPanel();
        outgoing = new MessageTreeTemplate(UIConstants.OUTGOING_DATA);

        variableSplitPane.setDividerLocation(84);
        variableSplitPane.setOrientation(javax.swing.JSplitPane.VERTICAL_SPLIT);
        variableListScrollPane.setViewportView(variableTable);

        variableSplitPane.setRightComponent(variableListScrollPane);

        variableReferencePane.setBackground(new java.awt.Color(255, 255, 255));
        variableReferenceDropDown.addActionListener(new java.awt.event.ActionListener()
        {
            public void actionPerformed(java.awt.event.ActionEvent evt)
            {
                variableReferenceDropDownActionPerformed(evt);
            }
        });

        variableScrollPane.setBackground(new java.awt.Color(255, 255, 255));
        variableScrollPane.setBorder(javax.swing.BorderFactory.createEmptyBorder(0, 0, 0, 0));
        variableScrollPane.setHorizontalScrollBarPolicy(javax.swing.ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER);
        variableScrollPane.setVerticalScrollBarPolicy(javax.swing.ScrollPaneConstants.VERTICAL_SCROLLBAR_NEVER);

        org.jdesktop.layout.GroupLayout variableReferencePaneLayout = new org.jdesktop.layout.GroupLayout(variableReferencePane);
        variableReferencePane.setLayout(variableReferencePaneLayout);
        variableReferencePaneLayout.setHorizontalGroup(
            variableReferencePaneLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(variableReferencePaneLayout.createSequentialGroup()
                .add(10, 10, 10)
                .add(variableReferenceDropDown, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 125, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(103, Short.MAX_VALUE))
            .add(variableScrollPane, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 238, Short.MAX_VALUE)
        );
        variableReferencePaneLayout.setVerticalGroup(
            variableReferencePaneLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(variableReferencePaneLayout.createSequentialGroup()
                .addContainerGap()
                .add(variableReferenceDropDown, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE, 22, org.jdesktop.layout.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(org.jdesktop.layout.LayoutStyle.RELATED)
                .add(variableScrollPane, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 44, Short.MAX_VALUE))
        );
        variableSplitPane.setLeftComponent(variableReferencePane);

        org.jdesktop.layout.GroupLayout variableTabLayout = new org.jdesktop.layout.GroupLayout(variableTab);
        variableTab.setLayout(variableTabLayout);
        variableTabLayout.setHorizontalGroup(
            variableTabLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(org.jdesktop.layout.GroupLayout.TRAILING, variableSplitPane, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 240, Short.MAX_VALUE)
        );
        variableTabLayout.setVerticalGroup(
            variableTabLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(variableSplitPane, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 525, Short.MAX_VALUE)
        );
        tabPanel.addTab("Reference", variableTab);

        incomingTab.setBackground(new java.awt.Color(255, 255, 255));

        org.jdesktop.layout.GroupLayout incomingTabLayout = new org.jdesktop.layout.GroupLayout(incomingTab);
        incomingTab.setLayout(incomingTabLayout);
        incomingTabLayout.setHorizontalGroup(
            incomingTabLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(incoming, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 240, Short.MAX_VALUE)
        );
        incomingTabLayout.setVerticalGroup(
            incomingTabLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(org.jdesktop.layout.GroupLayout.TRAILING, incoming, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 525, Short.MAX_VALUE)
        );
        tabPanel.addTab("Incoming Data", incomingTab);

        outgoingTab.setBackground(new java.awt.Color(255, 255, 255));

        org.jdesktop.layout.GroupLayout outgoingTabLayout = new org.jdesktop.layout.GroupLayout(outgoingTab);
        outgoingTab.setLayout(outgoingTabLayout);
        outgoingTabLayout.setHorizontalGroup(
            outgoingTabLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(outgoing, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 240, Short.MAX_VALUE)
        );
        outgoingTabLayout.setVerticalGroup(
            outgoingTabLayout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(org.jdesktop.layout.GroupLayout.TRAILING, outgoing, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 525, Short.MAX_VALUE)
        );
        tabPanel.addTab("Outgoing Data", outgoingTab);

        org.jdesktop.layout.GroupLayout layout = new org.jdesktop.layout.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(tabPanel, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 245, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(org.jdesktop.layout.GroupLayout.LEADING)
            .add(tabPanel, org.jdesktop.layout.GroupLayout.DEFAULT_SIZE, 553, Short.MAX_VALUE)
        );
    }// </editor-fold>//GEN-END:initComponents

    private void variableReferenceDropDownActionPerformed(java.awt.event.ActionEvent evt)//GEN-FIRST:event_variableReferenceDropDownActionPerformed
    {//GEN-HEADEREND:event_variableReferenceDropDownActionPerformed
       // variableViewPanel.removeAll();
        variableScrollPane.setViewportView((panels.get((String)variableReferenceDropDown.getSelectedItem())));
        //variableViewPanel.repaint();
    }//GEN-LAST:event_variableReferenceDropDownActionPerformed
    
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private com.webreach.mirth.client.ui.editors.MessageTreeTemplate incoming;
    public javax.swing.JPanel incomingTab;
    private com.webreach.mirth.client.ui.editors.MessageTreeTemplate outgoing;
    public javax.swing.JPanel outgoingTab;
    public javax.swing.JTabbedPane tabPanel;
    private javax.swing.JScrollPane variableListScrollPane;
    private com.webreach.mirth.client.ui.components.MirthComboBox variableReferenceDropDown;
    private javax.swing.JPanel variableReferencePane;
    private javax.swing.JScrollPane variableScrollPane;
    private javax.swing.JSplitPane variableSplitPane;
    private javax.swing.JPanel variableTab;
    private com.webreach.mirth.client.ui.panels.reference.VariableReferenceTable variableTable;
    // End of variables declaration//GEN-END:variables
    
}
